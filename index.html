<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Indonesia Mangrove Regulation Network</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #ffffff;
    --bg2: #f8f9fc;
    --bg3: #f0f3f8;
    --surface: rgba(0,0,0,0.04);
    --border: rgba(0,0,0,0.09);
    --text: #1a2740;
    --muted: #6b7f99;
    --accent: #0891b2;
    --accent2: #0369a1;

    --c-climate:  #00c98b;
    --c-conservation: #4fc3f7;
    --c-governance: #a78bfa;
    --c-planning: #f59e0b;
    --c-finance: #fb923c;
    --c-social: #f472b6;
    --c-other: #94a3b8;
  }

  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  /* HEADER */
  header {
    background: linear-gradient(135deg, #f0f6ff 0%, #e8f4fb 100%);
    border-bottom: 1px solid var(--border);
    padding: 14px 24px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
    z-index: 100;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
  }

  .header-left { display:flex; align-items:center; gap:14px; }
  .mangrove-icon {
    width: 42px; height: 42px;
    background: linear-gradient(135deg, #00c98b, #0891b2);
    border-radius: 10px;
    display: flex; align-items:center; justify-content:center;
    font-size: 22px;
    box-shadow: 0 4px 12px rgba(0,201,139,0.3);
  }
  .header-title h1 {
    font-family: 'Playfair Display', serif;
    font-size: 18px;
    font-weight: 700;
    color: #1a2740;
    letter-spacing: 0.3px;
  }
  .header-title p {
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 1px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .header-stats {
    display: flex; gap: 20px;
  }
  .stat-pill {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 5px 14px;
    font-size: 12px;
    color: var(--muted);
    display: flex; align-items:center; gap:6px;
  }
  .stat-pill strong { color: var(--accent); font-size: 14px; }

  .header-right { display:flex; gap:8px; }
  .btn {
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text);
    padding: 7px 14px;
    border-radius: 8px;
    font-size: 12px;
    cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    transition: all 0.2s;
    font-weight: 500;
  }
  .btn:hover { background: rgba(255,255,255,0.1); border-color: var(--accent); color: var(--accent); }
  .btn.active { background: rgba(0,212,184,0.15); border-color: var(--accent); color: var(--accent); }

  /* MAIN LAYOUT */
  .main { display:flex; flex:1; overflow:hidden; }

  /* LEFT SIDEBAR */
  .sidebar {
    width: 280px;
    background: var(--bg2);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    flex-shrink: 0;
    overflow: hidden;
  }

  .sidebar-section {
    padding: 16px;
    border-bottom: 1px solid var(--border);
  }
  .sidebar-section h3 {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--muted);
    font-weight: 600;
    margin-bottom: 12px;
  }

  /* SEARCH */
  .search-wrap { position:relative; }
  .search-wrap input {
    width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 9px 14px 9px 36px;
    color: var(--text);
    font-size: 12px;
    font-family: 'DM Sans', sans-serif;
    outline: none;
    transition: border-color 0.2s;
  }
  .search-wrap input:focus { border-color: var(--accent); }
  .search-wrap input::placeholder { color: var(--muted); }
  .search-icon {
    position:absolute; left:12px; top:50%; transform:translateY(-50%);
    color: var(--muted); font-size:14px; pointer-events:none;
  }

  /* FILTER CHIPS */
  .focus-filters { display:flex; flex-wrap:wrap; gap:6px; }
  .filter-chip {
    display: flex; align-items: center; gap:6px;
    padding: 5px 11px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 500;
    cursor: pointer;
    border: 1.5px solid transparent;
    transition: all 0.2s;
    user-select: none;
  }
  .filter-chip .dot {
    width: 7px; height: 7px; border-radius: 50%; flex-shrink:0;
  }
  .filter-chip.active { opacity:1; }
  .filter-chip.inactive { opacity:0.4; }

  /* REGULATION TYPE FILTERS */
  .type-filters { display:flex; flex-direction:column; gap:4px; }
  .type-item {
    display:flex; align-items:center; justify-content:space-between;
    padding: 7px 10px;
    border-radius: 7px;
    cursor: pointer;
    transition: background 0.15s;
    font-size: 12px;
    border: 1px solid transparent;
  }
  .type-item:hover { background: var(--surface); }
  .type-item.active { background: rgba(0,212,184,0.08); border-color: rgba(0,212,184,0.2); }
  .type-item .type-left { display:flex; align-items:center; gap:8px; }
  .type-shape { width:14px; height:14px; flex-shrink:0; }
  .type-count {
    font-size:10px; background: var(--surface);
    padding: 2px 7px; border-radius: 10px; color: var(--muted); font-weight:600;
  }

  /* NODE LIST */
  .node-list-wrap { flex:1; overflow-y:auto; padding: 0 12px 12px; }
  .node-list-wrap::-webkit-scrollbar { width:4px; }
  .node-list-wrap::-webkit-scrollbar-thumb { background: var(--border); border-radius:2px; }

  .node-card {
    padding: 10px;
    border: 1px solid var(--border);
    border-radius: 8px;
    margin-bottom: 6px;
    cursor: pointer;
    transition: all 0.15s;
    background: var(--surface);
  }
  .node-card:hover { border-color: var(--accent); background: rgba(0,212,184,0.05); }
  .node-card.highlighted { border-color: var(--accent); background: rgba(0,212,184,0.1); }
  .node-card-label { font-size: 12px; font-weight: 600; color: var(--text); margin-bottom: 3px; }
  .node-card-meta { font-size: 10px; color: var(--muted); display:flex; gap:8px; flex-wrap:wrap; }
  .node-focus-badge {
    font-size:9px; padding: 1px 6px; border-radius:10px; font-weight:600;
    text-transform:uppercase; letter-spacing:0.5px;
  }

  /* GRAPH AREA */
  .graph-area {
    flex:1;
    position: relative;
    overflow: hidden;
    background: #ffffff;
  }

  .graph-area svg {
    width:100%; height:100%;
  }

  /* TOOLTIP */
  .tooltip {
    position: absolute;
    background: #ffffff;
    border: 1px solid rgba(8,145,178,0.25);
    border-radius: 10px;
    padding: 14px 16px;
    max-width: 320px;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s;
    z-index: 1000;
    box-shadow: 0 8px 32px rgba(0,0,0,0.12);
  }
  .tooltip.visible { opacity:1; }
  .tt-label { font-size:14px; font-weight:700; color: var(--accent); font-family:'Playfair Display',serif; margin-bottom:4px; }
  .tt-type { font-size:10px; color: var(--muted); text-transform:uppercase; letter-spacing:1px; margin-bottom:8px; }
  .tt-desc { font-size:11px; color: var(--text); line-height:1.6; margin-bottom:8px; max-height:120px; overflow-y:auto; }
  .tt-meta { display:grid; grid-template-columns:1fr 1fr; gap:6px; }
  .tt-meta-item { background: var(--surface); border-radius:6px; padding:6px 8px; }
  .tt-meta-label { font-size:9px; color: var(--muted); text-transform:uppercase; letter-spacing:0.5px; margin-bottom:2px; }
  .tt-meta-val { font-size:12px; font-weight:600; color: var(--accent2); }
  .tt-link { margin-top:8px; }
  .tt-link a { font-size:11px; color: var(--accent); text-decoration:none; }
  .tt-link a:hover { text-decoration:underline; }

  /* RIGHT PANEL - details */
  .detail-panel {
    width: 300px;
    background: var(--bg2);
    border-left: 1px solid var(--border);
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: width 0.3s;
  }
  .detail-panel.hidden { width:0; }

  .panel-header {
    padding: 16px;
    border-bottom: 1px solid var(--border);
    display:flex; justify-content:space-between; align-items:center;
  }
  .panel-header h2 { font-size:13px; font-weight:600; font-family:'Playfair Display',serif; }
  .close-btn { cursor:pointer; color: var(--muted); font-size:18px; line-height:1; }
  .close-btn:hover { color: var(--text); }

  .panel-body { flex:1; overflow-y:auto; padding:16px; }
  .panel-body::-webkit-scrollbar { width:4px; }
  .panel-body::-webkit-scrollbar-thumb { background: var(--border); border-radius:2px; }

  .detail-label {
    font-family: 'Playfair Display', serif;
    font-size:20px; font-weight:700;
    color: var(--accent);
    margin-bottom: 4px;
    line-height: 1.2;
  }
  .detail-type-badge {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
    background: rgba(0,212,184,0.15);
    color: var(--accent);
    border: 1px solid rgba(0,212,184,0.3);
  }
  .detail-section { margin-bottom:16px; }
  .detail-section h4 { font-size:9px; text-transform:uppercase; letter-spacing:1.5px; color:var(--muted); font-weight:600; margin-bottom:8px; }
  .detail-desc { font-size:12px; line-height:1.7; color: var(--text); }
  .detail-cat {
    font-size: 11px; background: var(--surface); border: 1px solid var(--border);
    padding: 5px 10px; border-radius:6px; color: var(--text); display:inline-block;
  }
  .metrics-grid { display:grid; grid-template-columns:1fr 1fr; gap:8px; }
  .metric-card { background: var(--surface); border: 1px solid var(--border); border-radius:8px; padding:10px; }
  .metric-card .m-label { font-size:9px; text-transform:uppercase; letter-spacing:0.5px; color:var(--muted); margin-bottom:3px; }
  .metric-card .m-val { font-size:16px; font-weight:700; color: var(--accent2); }
  .connections-list { list-style:none; }
  .connections-list li {
    padding: 7px 10px; border-radius:6px; margin-bottom:4px;
    background: var(--surface); border: 1px solid var(--border);
    font-size: 11px; cursor:pointer; transition:all 0.15s;
    display:flex; align-items:center; gap:8px;
  }
  .connections-list li:hover { border-color:var(--accent); color: var(--accent); }
  .conn-arrow { color: var(--muted); font-size:10px; }
  .detail-link { display:block; margin-top:8px; }
  .detail-link a {
    display:flex; align-items:center; gap:6px;
    background: rgba(0,212,184,0.1); border: 1px solid rgba(0,212,184,0.3);
    border-radius:8px; padding:9px 12px;
    color: var(--accent); font-size:12px; text-decoration:none; font-weight:500;
    transition:all 0.2s;
  }
  .detail-link a:hover { background: rgba(0,212,184,0.2); }

  /* LEGEND */
  .legend {
    position: absolute;
    bottom: 20px;
    left: 20px;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(8px);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px 14px;
    z-index: 10;
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
  }
  .legend h4 { font-size:9px; text-transform:uppercase; letter-spacing:1.5px; color:var(--muted); margin-bottom:8px; font-weight:600; }
  .legend-items { display:flex; flex-direction:column; gap:5px; }
  .legend-item { display:flex; align-items:center; gap:8px; font-size:11px; color: var(--text); }
  .legend-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; }
  .legend-square { width:10px; height:10px; border-radius:2px; flex-shrink:0; }
  .legend-diamond { width:10px; height:10px; transform:rotate(45deg); flex-shrink:0; }
  .legend-triangle { width:0; height:0; border-left:6px solid transparent; border-right:6px solid transparent; border-bottom:10px solid; flex-shrink:0; }

  /* GRAPH CONTROLS */
  .graph-controls {
    position: absolute;
    top: 16px;
    right: 16px;
    display:flex; flex-direction:column; gap:6px;
    z-index:10;
  }
  .ctrl-btn {
    width:34px; height:34px;
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(8px);
    border: 1px solid var(--border);
    border-radius:8px;
    color: var(--text);
    cursor: pointer;
    font-size: 16px;
    display:flex; align-items:center; justify-content:center;
    transition: all 0.2s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  }
  .ctrl-btn:hover { border-color:var(--accent); color:var(--accent); }

  /* node & edge styles applied via D3 */
  .node-circle { cursor:pointer; transition: r 0.2s; }
  .node-label { font-family:'DM Sans',sans-serif; pointer-events:none; user-select:none; }
  .edge { stroke-opacity:0.35; }
  .edge.directed { marker-end: url(#arrow); }
  .edge.highlighted { stroke-opacity:0.9; stroke-width:2.5px !important; }
  .edge.faded { stroke-opacity:0.05; }
  .node-group.faded { opacity: 0.15; }
  .node-group.highlighted { filter: drop-shadow(0 0 8px currentColor); }

  /* EMPTY SEARCH */
  .no-results { text-align:center; padding:20px; color: var(--muted); font-size:12px; }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="header-left">
    <div class="mangrove-icon">üåø</div>
    <div class="header-title">
      <h1>Indonesia Mangrove Regulation Network</h1>
      <p>Regulatory Interconnection Map ¬∑ Kumu Dashboard</p>
    </div>
  </div>
  <div class="header-stats">
    <div class="stat-pill"><strong>81</strong> Regulations</div>
    <div class="stat-pill"><strong>118</strong> Connections</div>
    <div class="stat-pill"><strong>6</strong> Focus Areas</div>
  </div>
  <div class="header-right">
    <button class="btn active" id="btn-force" onclick="setLayout('force')">Force Graph</button>
    <button class="btn" id="btn-radial" onclick="setLayout('radial')">Radial</button>
    <button class="btn" onclick="resetView()">‚ü≥ Reset</button>
  </div>
</header>

<div class="main">
  <!-- LEFT SIDEBAR -->
  <div class="sidebar">
    <div class="sidebar-section">
      <div class="search-wrap">
        <span class="search-icon">üîç</span>
        <input type="text" id="searchInput" placeholder="Search regulations‚Ä¶" oninput="filterNodes(this.value)">
      </div>
    </div>

    <div class="sidebar-section">
      <h3>General Focus</h3>
      <div class="focus-filters" id="focusFilters"></div>
    </div>

    <div class="sidebar-section">
      <h3>Regulation Type</h3>
      <div class="type-filters" id="typeFilters"></div>
    </div>

    <div style="padding:12px 12px 4px; border-bottom:1px solid var(--border);">
      <span style="font-size:10px;text-transform:uppercase;letter-spacing:1.5px;color:var(--muted);font-weight:600;">Regulations</span>
      <span id="nodeCount" style="font-size:10px;color:var(--muted);float:right;"></span>
    </div>
    <div class="node-list-wrap" id="nodeList"></div>
  </div>

  <!-- GRAPH -->
  <div class="graph-area" id="graphArea">
    <svg id="mainSvg">
      <defs>
        <marker id="arrow" markerWidth="8" markerHeight="8" refX="12" refY="3" orient="auto">
          <path d="M0,0 L0,6 L8,3 z" fill="rgba(255,255,255,0.3)"/>
        </marker>
        <marker id="arrow-highlight" markerWidth="8" markerHeight="8" refX="12" refY="3" orient="auto">
          <path d="M0,0 L0,6 L8,3 z" fill="#00d4b8"/>
        </marker>
        <filter id="glow">
          <feGaussianBlur stdDeviation="3" result="blur"/>
          <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
        </filter>
      </defs>
    </svg>
    <div class="graph-controls">
      <button class="ctrl-btn" onclick="zoomIn()" title="Zoom In">+</button>
      <button class="ctrl-btn" onclick="zoomOut()" title="Zoom Out">‚àí</button>
      <button class="ctrl-btn" onclick="resetView()" title="Fit">‚ä°</button>
    </div>
    <div class="legend">
      <h4>General Focus</h4>
      <div class="legend-items" id="legendItems"></div>
    </div>
  </div>

  <!-- DETAIL PANEL -->
  <div class="detail-panel hidden" id="detailPanel">
    <div class="panel-header">
      <h2>Regulation Detail</h2>
      <span class="close-btn" onclick="closeDetail()">‚úï</span>
    </div>
    <div class="panel-body" id="detailBody"></div>
  </div>
</div>

<!-- TOOLTIP -->
<div class="tooltip" id="tooltip"></div>

<script>
// ‚îÄ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const rawElements = [{"Label":"KMLHK  716-2023","Description":"Decree of the Minister of Environment and Forestry No. 716 of 2023 on the Integration of Carbon Economic Value Mechanism in Approval, Partnership and Business Licensing in the Field of Environment and Forestry\n\nThis decree ensures that the economic value of carbon stored and sequestered in ecosystems, such as mangroves, is formally recognized in regulatory and business processes.","Category":"NEK in Environmental Permitting","General Focus":"Climate & Carbon","Link":"https://www.scribd.com/document/658832750/SK716-Pengintegrasian-Mekanisme-Nilai-Karbon-English-1","Regulation Type":"Ministerial Decree","degree":"2","size":"3"},{"Label":"PMLHK 71-2017","Description":"Regulation of the Minister of Environment and Forestry establishing the national web-based system to manage data and information on climate change actions and resources, including mangrove carbon activities.","Category":null,"General Focus":"Climate & Carbon","Link":"https://jdih.maritim.go.id/id/peraturan-menteri-lingkungan-hidup-dan-kehutanan-no-p71menlhksetjenkum1122017-tahun-2017","Regulation Type":"Ministerial Regulation","degree":"4","size":"5"},{"Label":"PMKP 14-2021","Description":null,"Category":"Standard Non-Food Fishery Products","General Focus":"Governance & Policy","Link":"https://peraturan.go.id/files/bn520-2021.pdf","Regulation Type":"Ministerial Regulation","degree":"0","size":"1"},{"Label":"PPRES 121-2012","Description":"Presidential Regulation No. 121/2012 on the Rehabilitation of Coastal Areas and Small Islands. Directs government efforts toward the restoration of degraded ecosystems, positioning mangrove rehabilitation as a key strategy.","Category":"Coastal & Island Rehabilitation","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/41366/perpres-no-121-tahun-2012","Regulation Type":"President Regulation","degree":"0","size":"1"},{"Label":"KMHUT 594-2025","Description":"Minister of Forestry Decree No. 594 of 2025 on the national mangrove map 2024. Updates and defines Indonesia's mangrove coverage based on the latest spatial data.","Category":"Mangroves Map","General Focus":"Conservation & Nature","Link":"https://www.bpdas-sjd.id/tdash/pdf/skpmn.pdf","Regulation Type":"Ministerial Decree","degree":"8","size":"9"},{"Label":"PP 23-2021","Description":"Government Regulation Number 23 of 2021 concerning the Implementation of Forestry. Provides a comprehensive framework for managing forest areas, including mangroves.","Category":"Forestry Permit System","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/161853/pp-no-23-tahun-2021","Regulation Type":"Government Regulation","degree":"4","size":"5"},{"Label":"PP 26-2020","Description":"Government Regulation No. 26 of 2020 on Forest Rehabilitation and Reclamation. Sets the framework for restoring and enhancing the function and productivity of degraded forests.","Category":"Forest & Land Rehabilitation","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/138323/pp-no-26-tahun-2020","Regulation Type":"Government Regulation","degree":"4","size":"5"},{"Label":"PMLHK 8-2021","Description":"Regulation of the Minister of Environment and Forestry Number 8 Year 2021 concerning Forest Arrangement and Preparation of Forest Management Plans.","Category":"Management of Protected and Production Forest Areas","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/235254/permen-lhk-no-8-tahun-2021","Regulation Type":"Ministerial Regulation","degree":"2","size":"3"},{"Label":"PPRES 51-2016","Description":"Presidential Regulation No. 51/2016 on Coastal Boundaries. Establishes legal basis for coastal buffer zones, ensuring that mangrove ecosystems are preserved.","Category":"Coastal Boundaries","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/40463/perpres-no-51-tahun-2016","Regulation Type":"President Regulation","degree":"0","size":"1"},{"Label":"PMLHK 9-2021","Description":"Minister of Environment and Forestry Regulation Number 9 of 2021 on Social Forestry Management. Enables local communities, indigenous peoples, and cooperatives to actively manage mangrove forests.","Category":"Social Forestry Legal Basis","General Focus":"Social & Community","Link":"https://peraturan.bpk.go.id/Details/235324/permen-lhk-no-9-tahun-2021","Regulation Type":"Ministerial Regulation","degree":"2","size":"3"},{"Label":"UU 11-2013","Description":null,"Category":"FPIC","General Focus":"Social & Community","Link":"https://peraturan.bpk.go.id/Details/38848","Regulation Type":"Law","degree":"0","size":"1"},{"Label":"PMKP 28-2021","Description":"Regulation of the Minister of Marine Affairs and Fisheries Number 28 of 2021 concerning the Implementation of Marine Spatial Planning.","Category":"Coastal Ecosystem Spatial Planning","General Focus":"Conservation & Nature","Link":"https://jdih.kkp.go.id/Homedev/DetailPeraturan/954","Regulation Type":"Ministerial Regulation","degree":"1","size":"2"},{"Label":"PP 108-2015","Description":"Government Regulation No. 108 of 2015 concerning Amendments to PP No. 28 of 2011 concerning Management of Nature Reserve Areas and Nature Conservation Areas.","Category":"Protected Area Governance","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/5687/pp-no-108-tahun-2015","Regulation Type":"Government Regulation","degree":"2","size":"3"},{"Label":"PMLHK 73-2017","Description":"Regulation of the Minister of Environment and Forestry No. P.73 on Guidelines for the Implementation and Reporting of National Greenhouse Gas Inventory.","Category":null,"General Focus":"Climate & Carbon","Link":"https://jdih.maritim.go.id/id/peraturan-menteri-lingkungan-hidup-dan-kehutanan-no-p73menlhksetjenkum1122017-tahun-2017","Regulation Type":"Ministerial Regulation","degree":"2","size":"3"},{"Label":"PMK 124/PMK.05/2020","Description":null,"Category":"Environmental Fund Management","General Focus":"Governance & Policy","Link":"https://peraturan.bpk.go.id/Details/145883/pmk-no-124pmk052020","Regulation Type":"Ministerial Regulation","degree":"0","size":"1"},{"Label":"UU 5-1990","Description":"Law No. 5 of 1990 concerning the Conservation of Living Natural Resources and their Ecosystems.","Category":"Conservation Law Foundation","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/46710/uu-no-5-tahun-1990","Regulation Type":"Law","degree":"5","size":"6"},{"Label":"UU 45-2009","Description":"Law No. 45 of 2009 concerning Amendment to Law Number 31 of 2004 concerning Fisheries. Acknowledges the interconnection between healthy mangrove ecosystems and sustainable fisheries.","Category":"Fisheries Management","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/38790/uu-no-45-tahun-2009","Regulation Type":"Law","degree":"2","size":"3"},{"Label":"Kep-00296/BEI/09-2023","Description":"Decree of the Board of Directors of PT Bursa Efek Indonesia No 00296/BEI/09-2023 on the Regulation of Carbon Unit Trading through Carbon Exchange Operator.","Category":"Market Oversight","General Focus":"Climate & Carbon","Link":"https://www.idxcarbon.co.id/document/share/19/000595bf-4854-4c5b-983f-4f6cdbd08c5f","Regulation Type":"Decree of the Board of Directors","degree":"1","size":"2"},{"Label":"PP 21-2021","Description":"Government Regulation No. 21 of 2023 on Spatial Planning Violations. Main legal framework for all national spatial planning activities, including land, sea, and coastal areas including mangroves.","Category":"Spatial Planning and Zoning","General Focus":"Planning & Data","Link":"https://peraturan.bpk.go.id/Details/161851/pp-no-21-tahun-2021","Regulation Type":"Government Regulation","degree":"8","size":"9"},{"Label":"PMLHK 23-2021","Description":"Regulation of the Minister of Environment and Forestry Number 23 of 2021 concerning the Implementation of Forest and Land Rehabilitation. Governs restoration and rehabilitation of degraded forest and land areas.","Category":"Forest Rehabilitation Technical Guidance","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/235350/permen-lhk-no-23-tahun-2021","Regulation Type":"Ministerial Regulation","degree":"4","size":"5"},{"Label":"Kep-00298/BEI/09-2023","Description":"Decree of the Board of Directors of PT Bursa Efek Indonesia No 00298/BEI/09-2023 concerning Regulation on the Supervision of Trading Through Carbon Exchange.","Category":"Carbon Exchange Services","General Focus":"Climate & Carbon","Link":"https://idxcarbon.co.id/document/share/17/058c6996-9a0c-4ecb-8fe8-709150a89999","Regulation Type":"Decree of the Board of Directors","degree":"1","size":"2"},{"Label":"PMLH 2-2025","Description":null,"Category":"Environmental Economic Instruments","General Focus":"Climate & Carbon","Link":"https://peraturan.go.id/id/permenklhbph-no-2-tahun-2025","Regulation Type":"Ministerial Regulation","degree":"1","size":"2"},{"Label":"UU 10-2009","Description":"Law No. 10 Year 2009 on Tourism. Emphasizes sustainable tourism development that enhances local welfare, creates business opportunities, and preserves the environment.","Category":"Sustainable Tourism","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/38598/uu-no-10-tahun-2009","Regulation Type":"Law","degree":"2","size":"3"},{"Label":"UU 4-2023","Description":"Law No. 4 of 2023 on the Development and Strengthening of the Financial Sector. Mandates all carbon transactions through the National Carbon Exchange.","Category":"Financial Sector Development & Governance","General Focus":"Finance & Markets","Link":"https://peraturan.bpk.go.id/Details/240203/uu-no-4-tahun-2023","Regulation Type":"Law","degree":"1","size":"2"},{"Label":"PMKP 2-2025","Description":"Regulation of the Minister of Maritime Affairs and Fisheries Number 2 of 2025 on the Organisation and Work Procedures of the Ministry of Maritime Affairs and Fisheries.","Category":"Ministry of Maritime Affairs Organization","General Focus":"Governance & Policy","Link":"https://peraturan.bpk.go.id/Details/314437/permen-kkp-no-2-tahun-2025","Regulation Type":"Ministerial Regulation","degree":"1","size":"2"},{"Label":"UU 32-2024","Description":"Law Number 32 of 2024 concerning Amendment to Law Number 5 of 1990 concerning the Conservation of Living Natural Resources. Strengthens enforcement and expands protection to coastal and mangrove ecosystems.","Category":"Biodiversity and Habitat Protection","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/295135/uu-no-32-tahun-2024","Regulation Type":"Law","degree":"1","size":"2"},{"Label":"PMLHK 74-2016","Description":"Regulation of the Minister of Environment and Forestry Number P.74 of 2016 concerning Guidelines for Nomenclature of Provincial and Regency/City Regional Apparatus.","Category":"Institutional Governance","General Focus":"Governance & Policy","Link":"https://peraturan.go.id/id/permen-lhk-no-p-74-menlhk-setjen-kum-1-8-2016-tahun-2016","Regulation Type":"Ministerial Regulation","degree":"1","size":"2"},{"Label":"PMHUT 1-2024","Description":"Ministry of Forestry Regulation No. 1 Year 2024 on the Organisation and Work Procedure of the Ministry of Forestry.","Category":"Ministry of Forestry Organization","General Focus":"Governance & Policy","Link":"https://peraturan.go.id/id/permenhut-no-1-tahun-2024","Regulation Type":"Ministerial Regulation","degree":"1","size":"2"},{"Label":"PMLHK 10-2021","Description":"Minister of Environment and Forestry Regulation Number 10 of 2021 on Community Seedling Gardens. Provides a guideline for community-based nurseries for mangrove reforestation.","Category":"Nursery Development","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/235326/permen-lhk-no-10-tahun-2021","Regulation Type":"Ministerial Regulation","degree":"1","size":"2"},{"Label":"UU 9-2015","Description":"Law No. 9 of 2015 Second Amendment to Law No. 23 of 2014 concerning Regional Government. Revises the division of authority between central, provincial, and district/city governments.","Category":"Local Governance & Decentralization","General Focus":"Governance & Policy","Link":"https://peraturan.bpk.go.id/Details/38209/uu-no-9-tahun-2015","Regulation Type":"Law","degree":"2","size":"3"},{"Label":"UU 16-2016","Description":"Law No. 16/2016 on the ratification of the Paris Agreement. Indonesia legally binds itself to global commitments to reduce emissions and strengthen climate resilience.","Category":"International Climate Commitment","General Focus":"Climate & Carbon","Link":"https://peraturan.bpk.go.id/Details/37573","Regulation Type":"Law","degree":"4","size":"5"},{"Label":"PBSN 14-2019","Description":null,"Category":"National Standard","General Focus":"Governance & Policy","Link":"https://peraturan.bpk.go.id/Details/170979/peraturan-bsn-no-14-tahun-2019","Regulation Type":"National Standardization Body Regulation","degree":"0","size":"1"},{"Label":"PMLHK 7-2023","Description":"Regulation of the Minister of Environment and Forestry of the Republic of Indonesia Number 7 of 2023 Concerning Procedures for Carbon Trading in the Forestry Sector.","Category":"Procedures for Carbon Trading in the Forestry Sector","General Focus":"Climate & Carbon","Link":"https://peraturan.bpk.go.id/Details/254282/permen-lhk-no-7-tahun-2023","Regulation Type":"Ministerial Regulation","degree":"4","size":"5"},{"Label":"PP 45-2021","Description":"Government Regulation No. 45 of 2021 on Implementation of Geospatial Information. Fundamentally establishes frameworks for collecting, managing, and sharing spatial data.","Category":"National Geospatial System","General Focus":"Planning & Data","Link":"https://peraturan.bpk.go.id/Details/161966/pp-no-45-tahun-2021","Regulation Type":"Government Regulation","degree":"3","size":"4"},{"Label":"PMLHK 10-2022","Description":"Regulation of the Minister of Environment and Forestry No. 10 of 2022 on the Preparation of General Plans for Watershed Forest and Land Rehabilitation.","Category":"Watershed Management Planning","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/235417/permen-lhk-no-10-tahun-2022","Regulation Type":"Ministerial Regulation","degree":"3","size":"4"},{"Label":"UU 1-2014","Description":"Law No. 1 of 2014 concerning Amendment to Law No. 27 of 2007 on the Management of Coastal Areas and Small Islands. Directly addresses conservation, protection, and restoration of coastal ecosystems.","Category":"Integrated Coastal Zone Management","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/38521/uu-no-1-tahun-2014","Regulation Type":"Law","degree":"4","size":"5"},{"Label":"PP 60-2007","Description":"Government Regulation No. 60 Year 2007 on the Conservation of Fish Resources. Provides legal framework for conserving fish resources, including ecosystem-based management.","Category":"Fisheries Resource Conservation & Management","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/4783/pp-no-60-tahun-2007","Regulation Type":"Government Regulation","degree":"1","size":"2"},{"Label":"UU 17-2007","Description":"Law No. 17 Year 2007 on the National Long-Term Development Plan 2005-2025. Sets the foundation for Indonesia's long-term development priorities.","Category":"National Long-Term Development Plan","General Focus":"Governance & Policy","Link":"https://peraturan.bpk.go.id/Details/39830/uu-no-17-tahun-2007","Regulation Type":"Law","degree":"1","size":"2"},{"Label":"UU 6-2023","Description":"Law No. 6 of 2023 on Stipulating Government Regulation in Lieu of Law No. 2 of 2022 on Job Creation. Legal foundation supporting spatial planning reform across sectors.","Category":"Regulatory Harmonization for Land/Sea Interface","General Focus":"Governance & Policy","Link":"https://peraturan.bpk.go.id/Details/246523/uu-no-6-tahun-2023","Regulation Type":"Law","degree":"10","size":"10"},{"Label":"UU 32-2009","Description":"Law No. 32 Year 2009 on Environmental Protection and Management. Fundamental environmental law of Indonesia, establishing the legal foundation for sustainable natural resource management.","Category":"Environmental Protection and Management","General Focus":"Governance & Policy","Link":"https://peraturan.bpk.go.id/Details/38771/uu-no-32-tahun-2009","Regulation Type":"Law","degree":"9","size":"10"},{"Label":"PMK 216/PMK.07/2021","Description":"Minister of Finance Regulation Number 216/PMK.07/2021 on the Use, Monitoring, and Evaluation of Forestry Natural Resources Revenue Sharing Funds.","Category":"Fiscal Benefit-Sharing","General Focus":"Finance & Markets","Link":"https://peraturan.bpk.go.id/Details/209511/pmk-no-216pmk072021","Regulation Type":"Ministerial Regulation","degree":"1","size":"2"},{"Label":"PPRES 175-2024","Description":"Presidential Regulation Number 175 of 2024 Concerning the Ministry of Forestry. Establishes the Ministry of Forestry as a separate entity focused exclusively on forestry affairs.","Category":"Institutional Framework","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/306886/perpres-no-175-tahun-2024","Regulation Type":"President Regulation","degree":"2","size":"3"},{"Label":"PMATR 14-2021","Description":"Regulation of the Minister of Agrarian Affairs No. 14 of 2021 concerning Guidelines for the Preparation of Databases and Presentation of Maps.","Category":"Geospatial Data Standards","General Focus":"Planning & Data","Link":"https://peraturan.bpk.go.id/Details/209801/permen-agrariakepala-bpn-no-14-tahun-2021","Regulation Type":"Ministerial Regulation","degree":"1","size":"2"},{"Label":"PP 28-2011","Description":"Government Regulation No. 28 of 2011 concerning Management of Nature Reserve Areas and Nature Conservation Areas.","Category":"Area-Based Conservation","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/5157","Regulation Type":"Government Regulation","degree":"3","size":"4"},{"Label":"Kep-00148/BEI/09-2024","Description":"Decree of the Board of Directors of PT Bursa Efek Indonesia Number Kep-00148/BEI/09-2024 concerning regulations on the use of carbon exchange services.","Category":"NEK in Marine & Fisheries","General Focus":"Climate & Carbon","Link":"https://wplibrary.co.id/sites/default/files/KEP-00148_BEI_09-2024.pdf","Regulation Type":"Decree of the Board of Directors","degree":"1","size":"2"},{"Label":"PPRES 39-2019","Description":"Presidential Regulation Number 39 of 2019 concerning One Data Indonesia. Mandates the standardization and synchronization of data collection and management.","Category":"National Data Transparency","General Focus":"Planning & Data","Link":"https://peraturan.bpk.go.id/Details/108813/perpres-no-39-tahun-2019","Regulation Type":"President Regulation","degree":"1","size":"2"},{"Label":"KDPJPRL 41-2021","Description":"Issued by Indonesia's Directorate General of Natural Resources and Ecosystem Conservation. Establishes technical guidelines for assessing the management effectiveness of essential ecosystems.","Category":"MRV Guideline Carbon Projects","General Focus":"Conservation & Nature","Link":"https://www.scribd.com/document/518073987/Perdirjen-P-1-KSDAE-BPE2-KSA-4-2-2021","Regulation Type":"Directorate Regulation","degree":"4","size":"5"},{"Label":"PMATR 13-2021","Description":"Minister of Agrarian Affairs Regulation No. 13 of 2021 on Spatial Use Permit Implementation and Program Synchronization.","Category":"Spatial Permit Synchronization","General Focus":"Planning & Data","Link":"https://peraturan.bpk.go.id/Details/209797/permen-agrariakepala-bpn-no-13-tahun-2021","Regulation Type":"Ministerial Regulation","degree":"1","size":"2"},{"Label":"KMLHK 1027-2023","Description":"Decision of The Minister of Environment and Forestry SK.1027/Menlhk On Carbon Trading Roadmap for The Forestry Sector.","Category":"Carbon Market (Forestry Sector)","General Focus":"Climate & Carbon","Link":"https://phl.menlhk.go.id/media/publikasi/publikasi_file_1700463144.pdf","Regulation Type":"Ministerial Decree","degree":"2","size":"3"},{"Label":"PPRES 27-2014","Description":"Presidential Regulation No. 27 of 2014 on the National Geospatial Information Network. Creates a network of geospatial data nodes across government institutions.","Category":"Geo-Information Infrastructure","General Focus":"Planning & Data","Link":"https://peraturan.bpk.go.id/Details/41513/perpres-no-27-tahun-2014","Regulation Type":"President Regulation","degree":"2","size":"3"},{"Label":"PMK 180/PMK.05/2022","Description":"Minister of Finance Regulation Number 180/PMK.05/2022 concerning Procedures for Managing Mangrove Rehabilitation Funds. Directly tied to mangrove ecosystem management.","Category":"Mangrove Rehabilitation Finance","General Focus":"Finance & Markets","Link":"https://peraturan.bpk.go.id/Details/232904/pmk-no-180pmk052022","Regulation Type":"Ministerial Regulation","degree":"3","size":"4"},{"Label":"PMLHK 27-2021","Description":"Regulation of the Minister of Environment and Forestry of the Republic of Indonesia Number 27 of 2021 Concerning the Environmental Quality Index.","Category":"Environmental Quality Index","General Focus":"Governance & Policy","Link":"https://peraturan.bpk.go.id/Details/235366/permen-lhk-no-27-tahun-2021","Regulation Type":"Ministerial Regulation","degree":"1","size":"2"},{"Label":"KPres 32-1990","Description":"Presidential Decree No. 32 of 1990 on Protected Area Management. Declares mangroves as protected areas, setting land-use restrictions and management standards.","Category":"Coastal Zone and Protected Area Management","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/63908/keppres-no-32-tahun-1990","Regulation Type":"Presidential Decree","degree":"1","size":"2"},{"Label":"PPres 56-2019","Description":"Presidential Regulation Number 56 of 2019 on the National Action Plan for Integrated Management of National Parks and National Marine Protected Areas 2018-2025.","Category":"Integrated Protected Area Management","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/121654/perpres-no-56-tahun-2019","Regulation Type":"President Regulation","degree":"7","size":"8"},{"Label":"PP 27-2025","Description":"Government Regulation No. 27 Year 2025 on The Protection and Management of Mangrove Ecosystems. Establishes a comprehensive framework specifically dedicated to mangrove ecosystem management.","Category":"Mangrove Protection and Management Framework","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/320198/pp-no-27-tahun-2025","Regulation Type":"Government Regulation","degree":"1","size":"2"},{"Label":"PPRES 98-2021","Description":"Presidential Regulation No. 98 of 2021 Concerning the Implementation of Carbon Economic Value for Achieving NDC Targets. Central to advancing Indonesia's climate commitments through carbon pricing.","Category":"National Carbon Pricing Framework","General Focus":"Governance & Policy","Link":"https://peraturan.bpk.go.id/Details/187122/perpres-no-98-tahun-2021","Regulation Type":"President Regulation","degree":"10","size":"11"},{"Label":"PMLH 26-2025","Description":null,"Category":"Mangrove Ecosystem Inventory","General Focus":"Conservation & Nature","Link":"https://peraturan.go.id/files/permenklhbph-no-26-tahun-2025.pdf","Regulation Type":"Ministerial Regulation","degree":"1","size":"2"},{"Label":"PMDAGRI 8-2009","Description":"Regulation of the Minister of Home Affairs Number 8 of 2009 concerning Amendments to Supervision Guidelines for Regional Government.","Category":"Monitoring Regional Government Performance","General Focus":"Governance & Policy","Link":"https://peraturan.bpk.go.id/Details/126321/permendagri-no-8-tahun-2009","Regulation Type":"Ministerial Regulation","degree":"0","size":"1"},{"Label":"PP 46-2017","Description":"Government Regulation No. 46/2017 on Environmental Economic Instruments. Introduces mechanisms such as payments for ecosystem services and market-based instruments.","Category":"Environmental Economic Instruments","General Focus":"Climate & Carbon","Link":"https://peraturan.bpk.go.id/Details/64701","Regulation Type":"Government Regulation","degree":"5","size":"6"},{"Label":"PDKSDAE 4/2-2021","Description":"Issued by Directorate General of Natural Resources and Ecosystem Conservation. Establishes technical guidelines for assessing management effectiveness of essential ecosystems.","Category":"MRV Guideline Carbon Projects","General Focus":"Conservation & Nature","Link":"https://www.scribd.com/document/518073987/Perdirjen-P-1-KSDAE-BPE2-KSA-4-2-2021","Regulation Type":"Directorate Regulation","degree":"7","size":"8"},{"Label":"PMATR 12-2021","Description":"Regulation of the Minister of Agrarian Affairs Number 12 of 2021 concerning Land Technical Considerations. Introduces the requirement for land technical considerations in development licensing.","Category":"Land Use Evaluation","General Focus":"Planning & Data","Link":"https://peraturan.bpk.go.id/Details/209796/permen-agrariakepala-bpn-no-12-tahun-2021","Regulation Type":"Ministerial Regulation","degree":"1","size":"2"},{"Label":"KMLHK 168-2022","Description":"Minister of Environment and Forestry Decree No. 168 of 2022 on Indonesia's Forestry and Other Land Use (FOLU) Net Sink 2030 for Climate Change Control.","Category":"National Carbon Accounting (FOLU)","General Focus":"Climate & Carbon","Link":"https://pdasrh.menlhk.go.id/newsdetail.php","Regulation Type":"Ministerial Decree","degree":"1","size":"2"},{"Label":"PMATR 11-2021","Description":"Regulation of the Minister of Agrarian Affairs Number 11 of 2021 concerning Procedures for Preparation, Review, Revision, and Issuance of Spatial Plans.","Category":"Spatial Planning Procedures","General Focus":"Planning & Data","Link":"https://peraturan.bpk.go.id/Details/209795/permen-agrariakepala-bpn-no-11-tahun-2021","Regulation Type":"Ministerial Regulation","degree":"1","size":"2"},{"Label":"PMLHK 72-2017","Description":"Regulation of the Minister of Environment and Forestry P.72 Concerning Guidelines for Implementation of MRV of Climate Change Control Actions.","Category":"MRV Systems for Climate Mitigation","General Focus":"Climate & Carbon","Link":"https://jdih.kemenkoinfra.go.id/cfind/source/files/permen-lhk/permenlhk-nomor-p.72-tahun-2017.pdf","Regulation Type":"Ministerial Regulation","degree":"0","size":"1"},{"Label":"PMLHK 105-2018","Description":"Minister of Environment and Forestry Regulation No. 105/2018 on Procedures for Implementation, Supporting Activities, Provision of Incentives for Forest and Land Rehabilitation.","Category":"Forest and Land Rehabilitation Incentives","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/163515/permen-lhk-no-105-tahun-2018","Regulation Type":"Ministerial Regulation","degree":"2","size":"3"},{"Label":"PMK 137/PMK.01/2019","Description":"Regulation of the Minister of Finance Number 137/PMK.01/2019 on the Organisation and Work Procedures of the Environmental Fund Management Agency (BPDLH).","Category":"Organisation and Work Procedure Indonesia Environment Fund","General Focus":"Finance & Markets","Link":"https://peraturan.bpk.go.id/Details/128168/pmk-no-137pmk012019","Regulation Type":"Ministerial Regulation","degree":"5","size":"6"},{"Label":"PPRES 23-2021","Description":"Presidential Regulation Number 23 of 2021: Amendment to Presidential Regulation Number 9 of 2016 on the Acceleration of Implementation of the One Map Policy.","Category":"One Map Policy Governance","General Focus":"Planning & Data","Link":"https://peraturan.bpk.go.id/Details/164964/perpres-no-23-tahun-2021","Regulation Type":"President Regulation","degree":"2","size":"3"},{"Label":"PMKP 1-2025","Description":"Regulation of the Minister of Maritime Affairs and Fisheries Number 1 of 2025 concerning Procedures for Implementing the Carbon Economic Value of the Marine Sector.","Category":"Marine Carbon Market Instruments","General Focus":"Climate & Carbon","Link":"https://peraturan.bpk.go.id/Details/314428/permen-kkp-no-1-tahun-2025","Regulation Type":"Ministerial Regulation","degree":"3","size":"4"},{"Label":"POJK 14-2023","Description":"Financial Services Authority Regulation No. 14 of 2023 on Carbon Trading through Carbon Exchanges. Provides the overarching legal and regulatory framework for Indonesia's carbon market.","Category":"Carbon Exchange Regulation","General Focus":"Climate & Carbon","Link":"https://www.scribd.com/document/667608309/JK-14-Tahun-2023-PERDAGANGAN-KARBON-MELALUI-BURSA-KARBON","Regulation Type":"Financial Services Authority Regulation","degree":"7","size":"8"},{"Label":"UU 41-1999","Description":"Law No. 41 Year 1999 on Forestry. Fundamental legal framework for forest management in Indonesia. Establishes that forests, including mangroves, are state-controlled assets.","Category":"Legal Basis for Forest Governance","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/45373/uu-no-41-tahun-1999","Regulation Type":"Law","degree":"9","size":"10"},{"Label":"PMLHK 11-2022","Description":"Regulation of the Minister of Environment and Forestry of the Republic of Indonesia Number 11 of 2022 Concerning Professions and Competencies of Forest Management Technical Personnel.","Category":null,"General Focus":"Governance & Policy","Link":"https://peraturan.bpk.go.id/Details/235418/permen-lhk-no-11-tahun-2022","Regulation Type":"Ministerial Regulation","degree":"2","size":"3"},{"Label":"PP 74-2012","Description":"Government Regulation No. 74 of 2012 concerning Amendments to Government Regulation No. 23 of 2005 concerning Financial Management of Public Service Entities.","Category":"Public Service Entity Support","General Focus":"Finance & Markets","Link":"https://peraturan.bpk.go.id/Details/5288/pp-no-74-tahun-2012","Regulation Type":"Government Regulation","degree":"1","size":"2"},{"Label":"PP 77-2018","Description":"Presidential Regulation No. 77/2018 on Environmental Fund Management. Establishes a system for managing environmental funds to finance environmental protection and restoration.","Category":"Environmental Fiscal Instruments","General Focus":"Finance & Markets","Link":"https://peraturan.bpk.go.id/Details/94707/perpres-no-77-tahun-2018","Regulation Type":"Government Regulation","degree":"5","size":"6"},{"Label":"PMLH 15-2012","Description":null,"Category":"Economic Valuation","General Focus":"Governance & Policy","Link":"https://www.peraturan.go.id/files/bn977-2012.pdf","Regulation Type":"Ministerial Regulation","degree":"0","size":"1"},{"Label":"UU 4-2011","Description":"Law No. 4 of 2011 on Geospatial Information. Provides the geospatial data infrastructure needed for foundational mapping, planning, and monitoring.","Category":"Legal Basis of Geospatial System","General Focus":"Planning & Data","Link":"https://peraturan.bpk.go.id/Details/39136/uu-no-4-tahun-2011","Regulation Type":"Law","degree":"6","size":"7"},{"Label":"PMLHK 4-2023","Description":"Minister of Environment and Forestry Regulation No. 4 of 2023 on Social Forestry Management in Forest Areas with Special Management.","Category":"Social Forestry Implementation","General Focus":"Social & Community","Link":"https://peraturan.bpk.go.id/Details/253766/permen-lhk-no-4-tahun-2023","Regulation Type":"Ministerial Regulation","degree":"2","size":"3"},{"Label":"PMLHK 15-2021","Description":"Regulation No. 15 of 2021 by the Minister of Environment and Forestry on the Organization and Work Procedures of the Ministry of Environment and Forestry.","Category":"Ministry of Environment and Forestry Organization","General Focus":"Governance & Policy","Link":"https://peraturan.bpk.go.id/Details/235337/permen-lhk-no-15-tahun-2021","Regulation Type":"Ministerial Regulation","degree":"6","size":"7"},{"Label":"PMLHK 24-2021","Description":"Regulation of the Minister of Environment and Forestry Number 24 of 2021 Concerning Procedures for Organizing Thematic Geospatial Information.","Category":"Environmental Geospatial Data","General Focus":"Planning & Data","Link":"https://peraturan.bpk.go.id/Details/235352/permen-lhk-no-24-tahun-2021","Regulation Type":"Ministerial Regulation","degree":"11","size":"11"},{"Label":"UU 23-2014","Description":"AMENDED. Sub-National Governance.","Category":"Sub-National Governance","General Focus":"Governance & Policy","Link":"https://peraturan.bpk.go.id/Details/38685/uu-no-23-tahun-2014","Regulation Type":"Law","degree":"0","size":"1"},{"Label":"PMLHK 7-2021","Description":"Regulation of the Minister of Environment and Forestry Number 7 of 2021 concerning Forestry Planning, Change of Designation and Function of Forest Areas, and Use of Forest Areas.","Category":"Licensing in environment and forestry sectors","General Focus":"Conservation & Nature","Link":"https://peraturan.bpk.go.id/Details/235244/permen-lhk-no-7-tahun-2021","Regulation Type":"Ministerial Regulation","degree":"9","size":"10"},{"Label":"PMLHK 21-2022","Description":"Regulation of the Minister of Environment and Forestry Number 21 of 2022 concerning Procedures for the Application of Carbon Economic Value.","Category":"NEK Technical Guidelines","General Focus":"Climate & Carbon","Link":"https://peraturan.bpk.go.id/Details/235421/permen-lhk-no-21-tahun-2022","Regulation Type":"Ministerial Regulation","degree":"7","size":"8"}];

const rawConnections = [{"From":"UU 6-2023","To":"UU 4-2011","Direction":"undirected"},{"From":"PMLHK 7-2021","To":"KMLHK 1027-2023","Direction":"directed"},{"From":"POJK 14-2023","To":"Kep-00148/BEI/09-2024","Direction":"directed"},{"From":"UU 32-2009","To":"PMLHK 24-2021","Direction":"directed"},{"From":"UU 5-1990","To":"PMLHK 7-2021","Direction":"directed"},{"From":"UU 17-2007","To":"PPRES 98-2021","Direction":"directed"},{"From":"PP 46-2017","To":"PP 77-2018","Direction":"directed"},{"From":"PMHUT 1-2024","To":"KMHUT 594-2025","Direction":"directed"},{"From":"UU 32-2009","To":"PMK 137/PMK.01/2019","Direction":"directed"},{"From":"PP 21-2021","To":"PMATR 13-2021","Direction":"directed"},{"From":"UU 41-1999","To":"PMLHK 71-2017","Direction":"directed"},{"From":"UU 6-2023","To":"PMLHK 24-2021","Direction":"directed"},{"From":"UU 16-2016","To":"PMLHK 71-2017","Direction":"directed"},{"From":"PP 21-2021","To":"PMKP 28-2021","Direction":"directed"},{"From":"UU 5-1990","To":"PP 108-2015","Direction":"directed"},{"From":"PP 21-2021","To":"KDPJPRL 41-2021","Direction":"undirected"},{"From":"PMLHK 15-2021","To":"PMLHK 10-2022","Direction":"directed"},{"From":"PMLHK 21-2022","To":"KMLHK 1027-2023","Direction":"directed"},{"From":"UU 4-2023","To":"POJK 14-2023","Direction":"directed"},{"From":"PP 77-2018","To":"PMK 137/PMK.01/2019","Direction":"directed"},{"From":"UU 32-2009","To":"PDKSDAE 4/2-2021","Direction":"directed"},{"From":"UU 41-1999","To":"PMLHK 73-2017","Direction":"directed"},{"From":"PMLHK 15-2021","To":"PMLHK 7-2021","Direction":"directed"},{"From":"PMLHK 10-2022","To":"KMHUT 594-2025","Direction":"directed"},{"From":"PMLHK 21-2022","To":"KMLHK  716-2023","Direction":"directed"},{"From":"PP 108-2015","To":"PP 28-2011","Direction":"undirected"},{"From":"PP 28-2011","To":"PDKSDAE 4/2-2021","Direction":"directed"},{"From":"PMLHK 15-2021","To":"PMLHK 27-2021","Direction":"directed"},{"From":"PPRES 98-2021","To":"KMLHK 168-2022","Direction":"directed"},{"From":"PMKP 2-2025","To":"PMKP 1-2025","Direction":"directed"},{"From":"PP 46-2017","To":"PMLHK 71-2017","Direction":"directed"},{"From":"PMK 137/PMK.01/2019","To":"PMK 180/PMK.05/2022","Direction":"directed"},{"From":"UU 16-2016","To":"PPRES 98-2021","Direction":"directed"},{"From":"PPRES 27-2014","To":"PMLHK 24-2021","Direction":"directed"},{"From":"UU 10-2009","To":"PPres 56-2019","Direction":"directed"},{"From":"PPRES 23-2021","To":"KMHUT 594-2025","Direction":"directed"},{"From":"UU 4-2011","To":"PPRES 27-2014","Direction":"directed"},{"From":"PP 45-2021","To":"PMLHK 24-2021","Direction":"directed"},{"From":"PMLHK 15-2021","To":"PMLHK 7-2023","Direction":"directed"},{"From":"PPRES 98-2021","To":"POJK 14-2023","Direction":"directed"},{"From":"UU 1-2014","To":"KDPJPRL 41-2021","Direction":"undirected"},{"From":"UU 1-2014","To":"PPres 56-2019","Direction":"directed"},{"From":"UU 45-2009","To":"PPres 56-2019","Direction":"directed"},{"From":"UU 41-1999","To":"PMLHK 7-2021","Direction":"directed"},{"From":"UU 6-2023","To":"UU 45-2009","Direction":"undirected"},{"From":"PMLHK 23-2021","To":"PMLHK 7-2023","Direction":"directed"},{"From":"UU 6-2023","To":"UU 32-2009","Direction":"undirected"},{"From":"UU 32-2009","To":"PPres 56-2019","Direction":"directed"},{"From":"PMLHK 23-2021","To":"PMK 216/PMK.07/2021","Direction":"directed"},{"From":"PP 26-2020","To":"PMLHK 10-2022","Direction":"directed"},{"From":"PP 27-2025","To":"PMLH 26-2025","Direction":"undirected"},{"From":"UU 6-2023","To":"UU 10-2009","Direction":"undirected"},{"From":"UU 41-1999","To":"PMLHK 105-2018","Direction":"directed"},{"From":"UU 9-2015","To":"PDKSDAE 4/2-2021","Direction":"directed"},{"From":"UU 6-2023","To":"UU 1-2014","Direction":"undirected"},{"From":"UU 16-2016","To":"PMLHK 73-2017","Direction":"directed"},{"From":"PP 28-2011","To":"PPres 56-2019","Direction":"directed"},{"From":"KPres 32-1990","To":"PDKSDAE 4/2-2021","Direction":"directed"},{"From":"UU 32-2009","To":"PMK 180/PMK.05/2022","Direction":"directed"},{"From":"PMLHK 21-2022","To":"PMLHK 7-2023","Direction":"directed"},{"From":"PP 21-2021","To":"PMATR 12-2021","Direction":"directed"},{"From":"UU 41-1999","To":"PDKSDAE 4/2-2021","Direction":"directed"},{"From":"PMLHK 74-2016","To":"PDKSDAE 4/2-2021","Direction":"directed"},{"From":"PP 46-2017","To":"PPRES 98-2021","Direction":"directed"},{"From":"PMLHK 21-2022","To":"PMLHK 7-2021","Direction":"directed"},{"From":"PPRES 98-2021","To":"PMKP 1-2025","Direction":"directed"},{"From":"PPRES 98-2021","To":"PMLHK 7-2021","Direction":"directed"},{"From":"PMLHK 23-2021","To":"PMLHK 4-2023","Direction":"directed"},{"From":"PMLHK 8-2021","To":"PMLHK 11-2022","Direction":"directed"},{"From":"PP 46-2017","To":"PMLH 2-2025","Direction":"undirected"},{"From":"UU 1-2014","To":"PP 21-2021","Direction":"directed"},{"From":"PP 23-2021","To":"PMLHK 24-2021","Direction":"directed"},{"From":"UU 4-2011","To":"KDPJPRL 41-2021","Direction":"undirected"},{"From":"PPRES 175-2024","To":"PMLHK 7-2021","Direction":"directed"},{"From":"PP 77-2018","To":"PMK 180/PMK.05/2022","Direction":"directed"},{"From":"UU 32-2009","To":"PMLHK 71-2017","Direction":"directed"},{"From":"PP 21-2021","To":"PMATR 11-2021","Direction":"directed"},{"From":"PMLHK 9-2021","To":"PMLHK 4-2023","Direction":"directed"},{"From":"UU 4-2011","To":"KMHUT 594-2025","Direction":"directed"},{"From":"PP 26-2020","To":"PMLHK 10-2021","Direction":"directed"},{"From":"PP 21-2021","To":"PMATR 14-2021","Direction":"directed"},{"From":"UU 32-2009","To":"PMLHK 105-2018","Direction":"directed"},{"From":"UU 4-2011","To":"PP 45-2021","Direction":"directed"},{"From":"PMLHK 21-2022","To":"POJK 14-2023","Direction":"directed"},{"From":"UU 5-1990","To":"PDKSDAE 4/2-2021","Direction":"directed"},{"From":"UU 16-2016","To":"POJK 14-2023","Direction":"directed"},{"From":"PP 74-2012","To":"PP 77-2018","Direction":"directed"},{"From":"UU 6-2023","To":"UU 41-1999","Direction":"undirected"},{"From":"PMLHK 15-2021","To":"PMLHK 24-2021","Direction":"directed"},{"From":"PPRES 175-2024","To":"KMHUT 594-2025","Direction":"directed"},{"From":"UU 9-2015","To":"PPRES 98-2021","Direction":"directed"},{"From":"POJK 14-2023","To":"Kep-00296/BEI/09-2023","Direction":"directed"},{"From":"PP 23-2021","To":"PMLHK 7-2021","Direction":"directed"},{"From":"PP 26-2020","To":"KMHUT 594-2025","Direction":"directed"},{"From":"PMLHK 21-2022","To":"PMKP 1-2025","Direction":"directed"},{"From":"POJK 14-2023","To":"Kep-00298/BEI/09-2023","Direction":"directed"},{"From":"PMLHK 15-2021","To":"PMLHK 11-2022","Direction":"directed"},{"From":"PPRES 39-2019","To":"PMLHK 24-2021","Direction":"directed"},{"From":"UU 4-2011","To":"PMLHK 24-2021","Direction":"directed"},{"From":"PP 60-2007","To":"PPres 56-2019","Direction":"directed"},{"From":"PPRES 98-2021","To":"PMLHK 7-2023","Direction":"directed"},{"From":"UU 5-1990","To":"PPres 56-2019","Direction":"directed"},{"From":"PP 45-2021","To":"KDPJPRL 41-2021","Direction":"undirected"},{"From":"PP 26-2020","To":"PMLHK 23-2021","Direction":"directed"},{"From":"UU 41-1999","To":"PMLHK 9-2021","Direction":"directed"},{"From":"UU 32-2009","To":"PP 77-2018","Direction":"directed"},{"From":"PPRES 98-2021","To":"PMLHK 21-2022","Direction":"directed"},{"From":"PMLHK 24-2021","To":"KMHUT 594-2025","Direction":"directed"},{"From":"UU 32-2024","To":"UU 5-1990","Direction":"undirected"},{"From":"UU 6-2023","To":"PP 21-2021","Direction":"directed"},{"From":"UU 41-1999","To":"PP 23-2021","Direction":"directed"},{"From":"PPRES 23-2021","To":"PMLHK 24-2021","Direction":"directed"},{"From":"PMLHK 7-2021","To":"KMLHK  716-2023","Direction":"directed"},{"From":"UU 41-1999","To":"PMK 137/PMK.01/2019","Direction":"directed"},{"From":"PP 46-2017","To":"PMK 137/PMK.01/2019","Direction":"directed"},{"From":"PP 23-2021","To":"PMLHK 8-2021","Direction":"directed"},{"From":"UU 6-2023","To":"KMHUT 594-2025","Direction":"directed"}];

// ‚îÄ‚îÄ‚îÄ COLORS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const FOCUS_COLORS = {
  "Climate & Carbon": "#00c98b",
  "Conservation & Nature": "#4fc3f7",
  "Governance & Policy": "#a78bfa",
  "Planning & Data": "#f59e0b",
  "Finance & Markets": "#fb923c",
  "Social & Community": "#f472b6",
  "Other": "#94a3b8"
};

// ‚îÄ‚îÄ‚îÄ REGULATION TYPE COLORS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const REG_TYPE_COLORS = {
  "Law": "#e53e3e",
  "Government Regulation": "#dd6b20",
  "President Regulation": "#d69e2e",
  "Presidential Decree": "#b7791f",
  "Ministerial Regulation": "#38a169",
  "Ministerial Decree": "#2b6cb0",
  "Decree of the Board of Directors": "#805ad5",
  "Financial Services Authority Regulation": "#d53f8c",
  "Directorate Regulation": "#0891b2",
  "National Standardization Body Regulation": "#718096"
};

function getFocusColor(focus) {
  return FOCUS_COLORS[focus] || FOCUS_COLORS["Other"];
}

function getRegTypeColor(regType) {
  return REG_TYPE_COLORS[regType] || '#718096';
}

// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let activeFilters = new Set(Object.keys(FOCUS_COLORS));
let activeTypes = new Set(Object.keys(REG_TYPE_COLORS));
let searchQuery = '';
let selectedNode = null;
let layoutMode = 'force';
let simulation;
let zoomBehavior;
let allNodes = [], allLinks = [];
let nodeMap = {};

// Build index
rawElements.forEach(e => { nodeMap[e.Label.trim()] = e; });

// ‚îÄ‚îÄ‚îÄ BUILD GRAPH DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
allNodes = rawElements.map((el, i) => ({
  id: el.Label.trim(),
  label: el.Label.trim(),
  focus: el["General Focus"] || "Other",
  category: el.Category,
  regType: el["Regulation Type"],
  description: el.Description,
  link: el.Link,
  degree: parseInt(el.degree) || 0,
  size: Math.max(5, Math.min(22, 5 + (parseInt(el.size)||1)*1.5)),
  color: getRegTypeColor(el["Regulation Type"]),
  focusColor: getFocusColor(el["General Focus"]),
  x: undefined, y: undefined
}));

allLinks = rawConnections.map(c => ({
  source: c.From.trim(),
  target: c.To.trim(),
  direction: c.Direction
})).filter(l => nodeMap[l.source] && nodeMap[l.target]);

// ‚îÄ‚îÄ‚îÄ BUILD SIDEBAR FILTERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildFilters() {
  // Focus filters
  const fc = document.getElementById('focusFilters');
  Object.entries(FOCUS_COLORS).forEach(([name, color]) => {
    const count = allNodes.filter(n => n.focus === name).length;
    if (!count) return;
    const chip = document.createElement('div');
    chip.className = 'filter-chip active';
    chip.dataset.focus = name;
    chip.style.background = color + '18';
    chip.style.borderColor = color + '60';
    chip.style.color = color;
    chip.innerHTML = `<span class="dot" style="background:${color}"></span>${name} <span style="opacity:0.6">(${count})</span>`;
    chip.onclick = () => toggleFocusFilter(name, chip, color);
    fc.appendChild(chip);
  });

  // Type filters
  const tc = document.getElementById('typeFilters');
  const types = [...new Set(allNodes.map(n => n.regType).filter(Boolean))].sort();
  types.forEach(type => {
    const count = allNodes.filter(n => n.regType === type).length;
    const item = document.createElement('div');
    item.className = 'type-item active';
    item.dataset.type = type;
    item.innerHTML = `<span class="type-left"><span class="type-name" style="font-size:11px">${type}</span></span><span class="type-count">${count}</span>`;
    item.onclick = () => toggleTypeFilter(type, item);
    tc.appendChild(item);
  });
}

function toggleFocusFilter(name, chip, color) {
  if (activeFilters.has(name)) {
    activeFilters.delete(name);
    chip.className = 'filter-chip inactive';
  } else {
    activeFilters.add(name);
    chip.className = 'filter-chip active';
  }
  updateVisibility();
}

function toggleTypeFilter(type, item) {
  if (activeTypes.has(type)) {
    activeTypes.delete(type);
    item.classList.remove('active');
  } else {
    activeTypes.add(type);
    item.classList.add('active');
  }
  updateVisibility();
}

// ‚îÄ‚îÄ‚îÄ LEGEND ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildLegend() {
  document.querySelector('.legend h4').textContent = 'Regulation Type';
  const li = document.getElementById('legendItems');
  li.innerHTML = '';
  Object.entries(REG_TYPE_COLORS).forEach(([name, color]) => {
    const count = allNodes.filter(n => n.regType === name).length;
    if (!count) return;
    const item = document.createElement('div');
    item.className = 'legend-item';
    item.innerHTML = `<span class="legend-dot" style="background:${color}"></span><span>${name}</span><span style="color:var(--muted);font-size:10px;margin-left:4px">(${count})</span>`;
    li.appendChild(item);
  });
}

// ‚îÄ‚îÄ‚îÄ NODE LIST ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function buildNodeList(nodes) {
  const list = document.getElementById('nodeList');
  const countEl = document.getElementById('nodeCount');
  list.innerHTML = '';
  countEl.textContent = nodes.length;
  if (!nodes.length) {
    list.innerHTML = '<div class="no-results">No regulations found</div>';
    return;
  }
  nodes.forEach(n => {
    const card = document.createElement('div');
    card.className = 'node-card' + (selectedNode && selectedNode.id === n.id ? ' highlighted' : '');
    card.dataset.id = n.id;
    const color = n.color;
    card.innerHTML = `
      <div class="node-card-label">${n.label}</div>
      <div class="node-card-meta">
        <span class="node-focus-badge" style="background:${n.color}22;color:${n.color};border:1px solid ${n.color}44">${n.regType || ''}</span>
        <span style="color:var(--muted)">${n.focus}</span>
      </div>`;
    card.onclick = () => selectNode(n.id);
    list.appendChild(card);
  });
}

// ‚îÄ‚îÄ‚îÄ D3 GRAPH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const svg = d3.select('#mainSvg');
let gContainer;
let linkSel, nodeSel;

function initGraph() {
  const el = document.getElementById('graphArea');
  const W = el.clientWidth, H = el.clientHeight;

  svg.selectAll('*:not(defs)').remove();
  gContainer = svg.append('g').attr('id', 'gContainer');

  zoomBehavior = d3.zoom()
    .scaleExtent([0.1, 5])
    .on('zoom', e => gContainer.attr('transform', e.transform));
  svg.call(zoomBehavior);
  svg.on('click', (e) => { if (e.target === svg.node()) deselectNode(); });

  // Build nodeColor lookup for edge coloring
  const nodeColorMap = {};
  allNodes.forEach(n => { nodeColorMap[n.id] = n.color; });

  // links
  linkSel = gContainer.append('g').attr('class', 'links')
    .selectAll('line')
    .data(allLinks)
    .enter().append('line')
    .attr('class', d => 'edge ' + d.direction)
    .attr('stroke', d => {
      const sId = typeof d.source === 'object' ? d.source.id : d.source;
      return (nodeColorMap[sId] || '#94a3b8') + '70';
    })
    .attr('stroke-width', 1);

  // nodes
  const nodeGroups = gContainer.append('g').attr('class', 'nodes')
    .selectAll('g')
    .data(allNodes)
    .enter().append('g')
    .attr('class', 'node-group')
    .attr('data-id', d => d.id)
    .style('cursor', 'pointer')
    .call(d3.drag()
      .on('start', dragStarted)
      .on('drag', dragged)
      .on('end', dragEnded))
    .on('click', (e, d) => { e.stopPropagation(); selectNode(d.id); })
    .on('mouseover', showTooltip)
    .on('mousemove', moveTooltip)
    .on('mouseout', hideTooltip);

  nodeGroups.append('circle')
    .attr('class', 'node-circle')
    .attr('r', d => d.size)
    .attr('fill', d => d.color + 'cc')
    .attr('stroke', d => d.color)
    .attr('stroke-width', 1.5);

  nodeGroups.append('text')
    .attr('class', 'node-label')
    .attr('dy', d => d.size + 10)
    .attr('text-anchor', 'middle')
    .attr('fill', '#334155')
    .attr('font-size', '9px')
    .text(d => d.label.length > 18 ? d.label.slice(0,16)+'‚Ä¶' : d.label);

  nodeSel = nodeGroups;

  simulation = d3.forceSimulation(allNodes)
    .force('link', d3.forceLink(allLinks).id(d => d.id).distance(80).strength(0.5))
    .force('charge', d3.forceManyBody().strength(-250))
    .force('center', d3.forceCenter(W/2, H/2))
    .force('collide', d3.forceCollide(d => d.size + 14))
    .on('tick', ticked);

  fitView();
}

function ticked() {
  linkSel
    .attr('x1', d => d.source.x)
    .attr('y1', d => d.source.y)
    .attr('x2', d => d.target.x)
    .attr('y2', d => d.target.y);
  nodeSel.attr('transform', d => `translate(${d.x},${d.y})`);
}

function dragStarted(e, d) {
  if (!e.active) simulation.alphaTarget(0.3).restart();
  d.fx = d.x; d.fy = d.y;
}
function dragged(e, d) { d.fx = e.x; d.fy = e.y; }
function dragEnded(e, d) {
  if (!e.active) simulation.alphaTarget(0);
  d.fx = null; d.fy = null;
}

// ‚îÄ‚îÄ‚îÄ VISIBILITY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getVisibleNodes() {
  return allNodes.filter(n => {
    const focusOk = activeFilters.has(n.focus) || (n.focus === null && activeFilters.has("Other"));
    const typeOk = !n.regType || activeTypes.has(n.regType);
    const searchOk = !searchQuery || n.label.toLowerCase().includes(searchQuery.toLowerCase()) || (n.category && n.category.toLowerCase().includes(searchQuery.toLowerCase()));
    return focusOk && typeOk && searchOk;
  });
}

function updateVisibility() {
  const visibleIds = new Set(getVisibleNodes().map(n => n.id));
  
  nodeSel.style('opacity', d => visibleIds.has(d.id) ? 1 : 0.07)
    .style('pointer-events', d => visibleIds.has(d.id) ? 'all' : 'none');

  linkSel.style('opacity', d => {
    const sId = typeof d.source === 'object' ? d.source.id : d.source;
    const tId = typeof d.target === 'object' ? d.target.id : d.target;
    return visibleIds.has(sId) && visibleIds.has(tId) ? 0.7 : 0.03;
  });

  buildNodeList(getVisibleNodes());
}

function filterNodes(q) {
  searchQuery = q;
  updateVisibility();
}

// ‚îÄ‚îÄ‚îÄ SELECTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function selectNode(id) {
  selectedNode = allNodes.find(n => n.id === id);
  if (!selectedNode) return;

  // Highlight connected
  const connectedIds = new Set([id]);
  allLinks.forEach(l => {
    const sId = typeof l.source === 'object' ? l.source.id : l.source;
    const tId = typeof l.target === 'object' ? l.target.id : l.target;
    if (sId === id) connectedIds.add(tId);
    if (tId === id) connectedIds.add(sId);
  });

  nodeSel.style('opacity', d => connectedIds.has(d.id) ? 1 : 0.12);
  linkSel.style('opacity', d => {
    const sId = typeof d.source === 'object' ? d.source.id : d.source;
    const tId = typeof d.target === 'object' ? d.target.id : d.target;
    return (sId === id || tId === id) ? 1 : 0.04;
  }).attr('stroke', d => {
    const sId = typeof d.source === 'object' ? d.source.id : d.source;
    const tId = typeof d.target === 'object' ? d.target.id : d.target;
    if (sId === id || tId === id) {
      return nodeColorMap[sId] || '#0891b2';
    }
    return (nodeColorMap[sId] || '#94a3b8') + '40';
  }).attr('stroke-width', d => {
    const sId = typeof d.source === 'object' ? d.source.id : d.source;
    const tId = typeof d.target === 'object' ? d.target.id : d.target;
    return (sId === id || tId === id) ? 2.5 : 1;
  });

  showDetailPanel(selectedNode, connectedIds);
  
  // Update node list
  document.querySelectorAll('.node-card').forEach(card => {
    card.classList.toggle('highlighted', card.dataset.id === id);
  });
}

function deselectNode() {
  selectedNode = null;
  updateVisibility();
  linkSel
    .attr('stroke', d => {
      const sId = typeof d.source === 'object' ? d.source.id : d.source;
      return (nodeColorMap[sId] || '#94a3b8') + '70';
    })
    .attr('stroke-width', 1);
  closeDetail();
  document.querySelectorAll('.node-card').forEach(c => c.classList.remove('highlighted'));
}

function showDetailPanel(node, connectedIds) {
  const panel = document.getElementById('detailPanel');
  const body = document.getElementById('detailBody');
  panel.classList.remove('hidden');

  const connections = allLinks.filter(l => {
    const sId = typeof l.source === 'object' ? l.source.id : l.source;
    const tId = typeof l.target === 'object' ? l.target.id : l.target;
    return sId === node.id || tId === node.id;
  });

  const outgoing = connections.filter(l => {
    const sId = typeof l.source === 'object' ? l.source.id : l.source;
    return sId === node.id;
  });
  const incoming = connections.filter(l => {
    const tId = typeof l.target === 'object' ? l.target.id : l.target;
    return tId === node.id;
  });

  const color = node.color;

  body.innerHTML = `
    <div class="detail-label">${node.label}</div>
    <div class="detail-type-badge" style="background:${node.color}22;color:${node.color};border-color:${node.color}44">${node.regType || 'Regulation'}</div>
    
    ${node.category ? `
    <div class="detail-section">
      <h4>Category</h4>
      <span class="detail-cat">${node.category}</span>
    </div>` : ''}

    ${node.description ? `
    <div class="detail-section">
      <h4>Description</h4>
      <p class="detail-desc">${node.description.split('\n')[0]}</p>
    </div>` : ''}

    <div class="detail-section">
      <h4>Network Metrics</h4>
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="m-label">Degree</div>
          <div class="m-val">${node.degree}</div>
        </div>
        <div class="metric-card">
          <div class="m-label">Focus Area</div>
          <div class="m-val" style="font-size:11px;color:${node.focusColor}">${node.focus}</div>
        </div>
        <div class="metric-card">
          <div class="m-label">Outgoing</div>
          <div class="m-val">${outgoing.length}</div>
        </div>
        <div class="metric-card">
          <div class="m-label">Incoming</div>
          <div class="m-val">${incoming.length}</div>
        </div>
      </div>
    </div>

    ${outgoing.length > 0 ? `
    <div class="detail-section">
      <h4>References (${outgoing.length})</h4>
      <ul class="connections-list">
        ${outgoing.slice(0,8).map(l => {
          const tId = typeof l.target === 'object' ? l.target.id : l.target;
          return `<li onclick="selectNode('${tId}')"><span class="conn-arrow">‚Üí</span>${tId}</li>`;
        }).join('')}
        ${outgoing.length > 8 ? `<li style="color:var(--muted);cursor:default">+${outgoing.length-8} more‚Ä¶</li>` : ''}
      </ul>
    </div>` : ''}

    ${incoming.length > 0 ? `
    <div class="detail-section">
      <h4>Referenced By (${incoming.length})</h4>
      <ul class="connections-list">
        ${incoming.slice(0,8).map(l => {
          const sId = typeof l.source === 'object' ? l.source.id : l.source;
          return `<li onclick="selectNode('${sId}')"><span class="conn-arrow">‚Üê</span>${sId}</li>`;
        }).join('')}
        ${incoming.length > 8 ? `<li style="color:var(--muted);cursor:default">+${incoming.length-8} more‚Ä¶</li>` : ''}
      </ul>
    </div>` : ''}

    ${node.link ? `
    <div class="detail-link">
      <a href="${node.link}" target="_blank" rel="noopener">
        üîó View Official Document
      </a>
    </div>` : ''}
  `;
}

function closeDetail() {
  document.getElementById('detailPanel').classList.add('hidden');
}

// ‚îÄ‚îÄ‚îÄ TOOLTIP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showTooltip(e, d) {
  const tt = document.getElementById('tooltip');
  const desc = d.description ? d.description.split('\n')[0].slice(0,180) + (d.description.length > 180 ? '‚Ä¶' : '') : 'No description available.';
  tt.innerHTML = `
    <div class="tt-label">${d.label}</div>
    <div class="tt-type">${d.regType || ''} ¬∑ ${d.focus}</div>
    <div class="tt-desc">${desc}</div>
    <div class="tt-meta">
      <div class="tt-meta-item"><div class="tt-meta-label">Degree</div><div class="tt-meta-val">${d.degree}</div></div>
      <div class="tt-meta-item"><div class="tt-meta-label">Category</div><div class="tt-meta-val" style="font-size:10px">${d.category || '‚Äî'}</div></div>
    </div>
    ${d.link ? `<div class="tt-link"><a href="${d.link}" target="_blank">üîó Official Link</a></div>` : ''}
  `;
  tt.classList.add('visible');
  moveTooltip(e);
}

function moveTooltip(e) {
  const tt = document.getElementById('tooltip');
  const ga = document.getElementById('graphArea').getBoundingClientRect();
  let x = e.clientX - ga.left + 16;
  let y = e.clientY - ga.top + 16;
  if (x + 340 > ga.width) x = e.clientX - ga.left - 340;
  if (y + 220 > ga.height) y = e.clientY - ga.top - 220;
  tt.style.left = x + 'px';
  tt.style.top = y + 'px';
}

function hideTooltip() {
  document.getElementById('tooltip').classList.remove('visible');
}

// ‚îÄ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function setLayout(mode) {
  layoutMode = mode;
  document.getElementById('btn-force').classList.toggle('active', mode === 'force');
  document.getElementById('btn-radial').classList.toggle('active', mode === 'radial');

  const el = document.getElementById('graphArea');
  const W = el.clientWidth, H = el.clientHeight;
  const cx = W/2, cy = H/2;

  if (mode === 'radial') {
    simulation.stop();
    const focuses = [...new Set(allNodes.map(n => n.focus))];
    allNodes.forEach((n, i) => {
      const focusIdx = focuses.indexOf(n.focus);
      const nodesInFocus = allNodes.filter(x => x.focus === n.focus);
      const posInFocus = nodesInFocus.indexOf(n);
      const angle = (focusIdx / focuses.length) * Math.PI * 2;
      const radius = 200 + posInFocus * 18;
      const spread = (posInFocus / nodesInFocus.length) * 0.8 - 0.4;
      n.x = cx + Math.cos(angle + spread) * radius;
      n.y = cy + Math.sin(angle + spread) * radius;
      n.fx = n.x; n.fy = n.y;
    });
    simulation.nodes(allNodes).alpha(0.3).restart();
    setTimeout(() => {
      allNodes.forEach(n => { n.fx = null; n.fy = null; });
    }, 1500);
  } else {
    allNodes.forEach(n => { n.fx = null; n.fy = null; });
    simulation.force('center', d3.forceCenter(cx, cy)).alpha(0.5).restart();
  }
}

function resetView() {
  const el = document.getElementById('graphArea');
  const W = el.clientWidth, H = el.clientHeight;
  svg.transition().duration(600)
    .call(zoomBehavior.transform, d3.zoomIdentity.translate(W/2, H/2).scale(0.7).translate(-W/2, -H/2));
  deselectNode();
  activeFilters = new Set(Object.keys(FOCUS_COLORS));
  activeTypes = new Set(Object.keys(REG_TYPE_COLORS));
  searchQuery = '';
  document.getElementById('searchInput').value = '';
  document.querySelectorAll('.filter-chip').forEach(c => c.className = 'filter-chip active');
  document.querySelectorAll('.type-item').forEach(i => i.classList.add('active'));
  updateVisibility();
}

function fitView() {
  const el = document.getElementById('graphArea');
  const W = el.clientWidth, H = el.clientHeight;
  svg.transition().duration(800)
    .call(zoomBehavior.transform, d3.zoomIdentity.translate(W*0.05, H*0.05).scale(0.9));
}

function zoomIn() { svg.transition().duration(300).call(zoomBehavior.scaleBy, 1.4); }
function zoomOut() { svg.transition().duration(300).call(zoomBehavior.scaleBy, 0.7); }

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.addEventListener('load', () => {
  buildFilters();
  buildLegend();
  initGraph();
  buildNodeList(allNodes);
});

window.addEventListener('resize', () => {
  const el = document.getElementById('graphArea');
  const W = el.clientWidth, H = el.clientHeight;
  if (simulation) {
    simulation.force('center', d3.forceCenter(W/2, H/2)).alpha(0.1).restart();
  }
});
</script>
</body>
</html>
